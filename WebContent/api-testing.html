<!DOCTYPE html>
<html>
	<head>
		<link rel="icon" type="image/png" href="assets/img/favicon.ico">
		<title>API TESTING</title>
		<!-- jQuery -->
		<script src="http://code.jquery.com/jquery-3.2.0.min.js"></script>

		<script>
		// function fetchTwitter() {
		// 	console.log("Fetching news...");

		// 	// AP
			// $.ajax({
			// 	dataType: "json",
			// 	// Grabs JSON from url
			// 	url: "https://api.twitter.com/1.1/search/tweets.json?q=%23freebandnames&since_id=24012619984051000&max_id=250126199840518145&result_type=mixed&count=4",
			// 	success: function(response) {
			// 		// "response" is a JSON with the returned data
			// 		console.log(response);
			// 		output_element = "#card";
			// 		// "articles" is an array of articles
			// 		articles = response.articles;
			// 		for (var i = 0; i < articles.length; i++) {
			// 			currentArticle = articles[i];

			// 			img = "<img height='120px' src='" + currentArticle.urlToImage + "'>";
			// 			title = JSON.stringify(currentArticle.title);
			// 			url = JSON.stringify(currentArticle.url);
			// 			description = "<p>" + clean_stringify(currentArticle.description) + "</p>";

			// 			$(output_element).append("<div class='card'><div class='header'>")
			// 			$(output_element).append("<h4 class='title'>" + "<a href=" + url + ">" + title + "<a/></h4>");
			// 			$(output_element).append("<p class='category'>Subtitle</p></div>");
			// 			$(output_element).append("<div class='content'>" + img + description + "</div></div>");
			// 		}
			// 	}
			// });

		// 	function clean_stringify(input_string) {
		// 		return JSON.stringify(input_string).replace("\\", "").replace("\\", "").replace("\\", "").replace("\\", "");
		// 	}
		// }

		lat = 0;
		long = 0;
		city = "Flavortown";

		function fetchLocation() {
		    if (navigator.geolocation) {
		        navigator.geolocation.getCurrentPosition(getPositon);
		    } else {
		        $("#card").html("Geolocation is not supported by this browser.");
		    }

			function getPositon(position) {
			    lat = position.coords.latitude;
			    long = position.coords.longitude;
		        $.ajax({
					dataType: "json",
					// Grabs JSON from url
					url: "https://maps.googleapis.com/maps/api/geocode/json?latlng=" + lat + "," + long + "&key=AIzaSyBybJlDH9Ioc3s3Xi8GagmzxL3D19pU8QM",
					success: function(response) {
						// "response" is a JSON with the returned data
						city = response.results[3].formatted_address;
						console.log("from Google Reverse Geocoding API, city: " + city);
					}
				});
			}
		}

		function fetchTweets() {
			// $.ajax({
			// 	dataType: "json",
			// 	// Grabs JSON from url
			// 	url: "https://api.twitter.com/1.1/geo/search.json?lat=" + lat + "&long=" + long,
			// 	success: function(response) {
			// 		// "response" is a JSON with the returned data
			// 		console.log(response);
			// 	}
			// });
			$.ajax({
				type: "GET",
				// Grabs JSON from url
				url: "test.php",
				success: function(response) {
					// "response" is a JSON with the returned data
					console.log(response);
					fetchWeather();
				}
			});
		}

		function fetchWeather() {
		    var key = "91153d239d63d420";
	        $.ajax({
				dataType: "json",
				// Grabs JSON from url
				url: "http://api.wunderground.com/api/" + key + "/forecast/geolookup/conditions/q/" + lat + "," + long + ".json",
				success: function(response) {
					// "response" is a JSON with the returned data
					console.log(response);
					$("#card").html(response.current_observation.temperature_string);

					$("#card").append("<img src=" + response.current_observation.icon_url + ">");

					$("#card").append("<p>" + response.location.city + "</p>");
				}
			});
		}


		</script>

	</head>

	<body>

	<?php
	echo "My first PHP script!";
	?> 

	<button type="button" onclick='fetchLocation()'>fetch location</button>
	<button type="button" onclick='fetchTweets()'>fetch twitter</button>	
	<button type="button" onclick='fetchWeather()'>fetch weather</button>
	<h1>Fetched data:</h1>
	<div id="card">help</div>
	</body>
</html>

